const pramData = {"verts":[{"x":1,"y":0,"z":5},{"x":0,"y":-7,"z":5},{"x":3,"y":-6,"z":5},{"x":5,"y":-3,"z":5},{"x":6,"y":0,"z":5},{"x":4,"y":5,"z":5},{"x":-5,"y":5,"z":5},{"x":-6.5,"y":1,"z":5},{"x":-6,"y":0,"z":5},{"x":1,"y":0,"z":-5},{"x":0,"y":-7,"z":-5},{"x":3,"y":-6,"z":-5},{"x":5,"y":-3,"z":-5},{"x":6,"y":0,"z":-5},{"x":4,"y":5,"z":-5},{"x":-5,"y":5,"z":-5},{"x":-6.5,"y":1,"z":-5},{"x":-6,"y":0,"z":-5},{"x":2,"y":5,"z":5},{"x":4,"y":9,"z":5},{"x":-2,"y":5,"z":5},{"x":-5,"y":9,"z":5},{"x":2,"y":5,"z":-5},{"x":4,"y":9,"z":-5},{"x":-2,"y":5,"z":-5},{"x":-5,"y":9,"z":-5},{"x":-2.5,"y":9,"z":5},{"x":-2.690301168721783,"y":9.956708580912725,"z":5},{"x":-3.232233047033631,"y":10.767766952966369,"z":5},{"x":-4.043291419087275,"y":11.309698831278217,"z":5},{"x":-5,"y":11.5,"z":5},{"x":-5.956708580912724,"y":11.309698831278217,"z":5},{"x":-6.767766952966369,"y":10.767766952966369,"z":5},{"x":-7.309698831278217,"y":9.956708580912725,"z":5},{"x":-7.5,"y":9,"z":5},{"x":-7.309698831278217,"y":8.043291419087275,"z":5},{"x":-6.767766952966369,"y":7.232233047033631,"z":5},{"x":-5.956708580912726,"y":6.690301168721784,"z":5},{"x":-5.000000000000001,"y":6.5,"z":5},{"x":-4.043291419087275,"y":6.690301168721783,"z":5},{"x":-3.2322330470336316,"y":7.232233047033631,"z":5},{"x":-2.690301168721784,"y":8.043291419087273,"z":5},{"x":-2.5,"y":9,"z":-5},{"x":-2.690301168721783,"y":9.956708580912725,"z":-5},{"x":-3.232233047033631,"y":10.767766952966369,"z":-5},{"x":-4.043291419087275,"y":11.309698831278217,"z":-5},{"x":-5,"y":11.5,"z":-5},{"x":-5.956708580912724,"y":11.309698831278217,"z":-5},{"x":-6.767766952966369,"y":10.767766952966369,"z":-5},{"x":-7.309698831278217,"y":9.956708580912725,"z":-5},{"x":-7.5,"y":9,"z":-5},{"x":-7.309698831278217,"y":8.043291419087275,"z":-5},{"x":-6.767766952966369,"y":7.232233047033631,"z":-5},{"x":-5.956708580912726,"y":6.690301168721784,"z":-5},{"x":-5.000000000000001,"y":6.5,"z":-5},{"x":-4.043291419087275,"y":6.690301168721783,"z":-5},{"x":-3.2322330470336316,"y":7.232233047033631,"z":-5},{"x":-2.690301168721784,"y":8.043291419087273,"z":-5},{"x":6.5,"y":9,"z":5},{"x":6.309698831278217,"y":9.956708580912725,"z":5},{"x":5.767766952966369,"y":10.767766952966369,"z":5},{"x":4.956708580912725,"y":11.309698831278217,"z":5},{"x":4,"y":11.5,"z":5},{"x":3.043291419087276,"y":11.309698831278217,"z":5},{"x":2.232233047033631,"y":10.767766952966369,"z":5},{"x":1.690301168721783,"y":9.956708580912725,"z":5},{"x":1.5,"y":9,"z":5},{"x":1.690301168721783,"y":8.043291419087275,"z":5},{"x":2.2322330470336307,"y":7.232233047033631,"z":5},{"x":3.043291419087274,"y":6.690301168721784,"z":5},{"x":3.9999999999999996,"y":6.5,"z":5},{"x":4.956708580912725,"y":6.690301168721783,"z":5},{"x":5.767766952966369,"y":7.232233047033631,"z":5},{"x":6.309698831278216,"y":8.043291419087273,"z":5},{"x":6.5,"y":9,"z":-5},{"x":6.309698831278217,"y":9.956708580912725,"z":-5},{"x":5.767766952966369,"y":10.767766952966369,"z":-5},{"x":4.956708580912725,"y":11.309698831278217,"z":-5},{"x":4,"y":11.5,"z":-5},{"x":3.043291419087276,"y":11.309698831278217,"z":-5},{"x":2.232233047033631,"y":10.767766952966369,"z":-5},{"x":1.690301168721783,"y":9.956708580912725,"z":-5},{"x":1.5,"y":9,"z":-5},{"x":1.690301168721783,"y":8.043291419087275,"z":-5},{"x":2.2322330470336307,"y":7.232233047033631,"z":-5},{"x":3.043291419087274,"y":6.690301168721784,"z":-5},{"x":3.9999999999999996,"y":6.5,"z":-5},{"x":4.956708580912725,"y":6.690301168721783,"z":-5},{"x":5.767766952966369,"y":7.232233047033631,"z":-5},{"x":6.309698831278216,"y":8.043291419087273,"z":-5}],"edges":[[8,0],[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],[6,7],[7,8],[17,9],[9,10],[10,11],[11,12],[12,13],[13,14],[14,15],[15,16],[16,17],[0,9],[1,10],[2,11],[3,12],[4,13],[5,14],[6,15],[7,16],[8,17],[18,19],[20,21],[22,23],[24,25],[26,27],[27,28],[28,29],[29,30],[30,31],[31,32],[32,33],[33,34],[34,35],[35,36],[36,37],[37,38],[38,39],[39,40],[40,41],[41,26],[42,43],[43,44],[44,45],[45,46],[46,47],[47,48],[48,49],[49,50],[50,51],[51,52],[52,53],[53,54],[54,55],[55,56],[56,57],[57,42],[58,59],[59,60],[60,61],[61,62],[62,63],[63,64],[64,65],[65,66],[66,67],[67,68],[68,69],[69,70],[70,71],[71,72],[72,73],[73,58],[74,75],[75,76],[76,77],[77,78],[78,79],[79,80],[80,81],[81,82],[82,83],[83,84],[84,85],[85,86],[86,87],[87,88],[88,89],[89,74]],"scale":15};

class Vert{
  constructor(x,y,z){
    this.x = x;
    this.y = y;
    this.z = z;
  }
  move(x,y,z){
    this.x+=x;
    this.y+=y;
    this.z+=z;
  }
}

class Wireframe{
  constructor(v,e){
    this.verts = v;
    this.edges = e;
    this.scale = 1;
  }
  move(x,y,z){
    for(let v of this.verts){
      v.move(x,y,z);
    }
  }
  add(w){
    const oldVertCount = this.verts.length;
    this.verts = this.verts.concat(w.verts);
    for(let i = 0; i<w.edges.length; i++){
      this.edges.push([w.edges[i][0]+oldVertCount,w.edges[i][1]+oldVertCount]);
    }
  }
  render(){
    for(let e of this.edges){
      line(this.verts[e[0]].x*this.scale,this.verts[e[0]].y*this.scale,this.verts[e[0]].z*this.scale,this.verts[e[1]].x*this.scale,this.verts[e[1]].y*this.scale,this.verts[e[1]].z*this.scale);
    }
  }
}

function makeCircle(r,points){
  let p = [];
  let e = [];
  const angleIncrement = TWO_PI/points;
  for(let i = 0; i<points; i++){
    p.push(new Vert(r*cos(angleIncrement*i),r*sin(angleIncrement*i),0));
    if(i<points-1){
      e.push([i,i+1]);
    }
  }
  e.push([points-1,0]);
  return new Wireframe(p,e);
}

function makeHalfPramLegs(zOff){
  const v = [
    new Vert(2,5,zOff),
    new Vert(4,9,zOff),
    new Vert(-2,5,zOff),
    new Vert(-5,9,zOff)
  ];
  const e = [
    [0,1],
    [2,3]
  ];
  return new Wireframe(v,e);
}

function makeHalfPramBody(zOff){
  const v = [
    new Vert(1,0,zOff),
    new Vert(0,-7,zOff),
    new Vert(3,-6,zOff),
    new Vert(5,-3,zOff),
    new Vert(6,0,zOff),
    new Vert(4,5,zOff),
    new Vert(-5,5,zOff),
    new Vert(-6.5,1,zOff),
    new Vert(-6,0,zOff)
  ];
  let e = [];
  e.push([v.length-1,0]);
  for(let i = 0; i<v.length-1; i++){
    e.push([i,i+1]);
  }
  return new Wireframe(v,e);
}

//this function generates the pram the way the C++ code on the Stepchild generates the pram
//but it's much faster/easier just to load the wireframe from an array or json
//instead of calculating all the vert positions
function makePram(){
  const zOff = 5;
  let pram = makeHalfPramBody(zOff);
  let vertCount = pram.verts.length;
  pram.add(makeHalfPramBody(-zOff));
  //stitching halves together (this could def be its own function)
  for(let i = 0; i<vertCount; i++){
    pram.edges.push([i,i+vertCount]);
  }
  pram.add(makeHalfPramLegs(zOff));
  pram.add(makeHalfPramLegs(-zOff));
  
  //wheels
  const circleResolution = 16;
  let c1 = makeCircle(2.5,circleResolution);
  let c2 = makeCircle(2.5,circleResolution);
  let c3 = makeCircle(2.5,circleResolution);
  let c4 = makeCircle(2.5,circleResolution);
  c1.move(-5,9,zOff);
  c2.move(-5,9,-zOff);
  c3.move(4,9,zOff);
  c4.move(4,9,-zOff);
  pram.add(c1);
  pram.add(c2);
  pram.add(c3);
  pram.add(c4);

  return pram;
}

let pram;

function setup() {
    //set up canvas
    setAttributes('antialias',false);
    pixelDensity(0.5);
    createCanvas(200,200,WEBGL);
    let canvas = document.getElementById("defaultCanvas0");
    canvas.style['margin'] = 'auto';
    canvas.style['width'] = width;
    canvas.style['display'] = 'block';

    //load wireframe from script (faster), OR make one on the fly
    pram = new Wireframe(pramData.verts,pramData.edges);
    pram.scale = 4;
//   console.log(JSON.stringify(pram));
//   pram = makePram();
}

//moving menu to face mouse
function faceMouse(){
    let xAngle = map((mouseY-height/2),-windowWidth/2,windowHeight/2,PI/4,-PI/4)*(0.6);
    let yAngle = map((mouseX-width/2),-height/2,height/2,PI/8,0)*(-0.6);
    rotation.x = xAngle;
    rotation.y = yAngle;
}

const rotation = {x: -6.45, y: -5.38};

function draw() {
    faceMouse();
    rotateX(rotation.x);
    rotateY(rotation.y+frameCount/100);
    clear();
    strokeWeight(2);
    stroke(0);
    pram.render();
}